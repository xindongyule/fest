<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš¨ ç´§æ€¥å¯†ç é‡ç½®å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            max-width: 700px;
            width: 100%;
            border: 3px solid #ff6b6b;
        }
        
        .warning-header {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .warning-header h1 {
            margin: 0 0 10px 0;
            color: #dc3545;
            font-size: 24px;
        }
        
        .instructions {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
        }
        
        .instructions h3 {
            margin: 0 0 15px 0;
            color: #dc3545;
        }
        
        .instructions ol {
            margin: 0;
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        input[type="password"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }
        
        input[type="password"]:focus {
            outline: none;
            border-color: #dc3545;
        }
        
        button {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
        }
        
        .result {
            margin-top: 20px;
            padding: 16px;
            border-radius: 8px;
            display: none;
        }
        
        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .security-note {
            background: #e2e3e5;
            border-left: 4px solid #6c757d;
            padding: 16px;
            margin-top: 25px;
        }
        
        .security-note h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        
        .domain-check {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .domain-check.safe {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        
        .domain-check.unsafe {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="warning-header">
            <h1>ğŸš¨ ç´§æ€¥å¯†ç é‡ç½®å·¥å…·</h1>
            <p><strong>è­¦å‘Šï¼š</strong>æ­¤å·¥å…·å…·æœ‰ç®¡ç†å‘˜æƒé™ï¼Œä»…åœ¨ç´§æ€¥æƒ…å†µä¸‹ä½¿ç”¨ï¼</p>
        </div>
        
        <div id="domainCheck" class="domain-check">
            <strong>ğŸ” æ­£åœ¨éªŒè¯å½“å‰åŸŸå...</strong>
        </div>
        
        <div class="instructions">
            <h3>âš ï¸ ä½¿ç”¨å‰é¡»çŸ¥ï¼š</h3>
            <ol>
                <li><strong>ä»…é™ç´§æ€¥æƒ…å†µä½¿ç”¨</strong>ï¼šå½“æ— æ³•é€šè¿‡æ­£å¸¸é€”å¾„ä¿®æ”¹å¯†ç æ—¶</li>
                <li><strong>éœ€è¦ç‰©ç†è®¿é—®æƒé™</strong>ï¼šç¡®ä¿æ‚¨æœ‰æƒè®¿é—®æ­¤ç½‘ç«™çš„ç®¡ç†åå°</li>
                <li><strong>ä½¿ç”¨åç«‹å³åˆ é™¤</strong>ï¼šå®Œæˆé‡ç½®ååº”ç«‹å³åˆ é™¤æ­¤æ–‡ä»¶</li>
                <li><strong>è®¾ç½®å¼ºå¯†ç </strong>ï¼šæ–°å¯†ç åº”åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦</li>
                <li><strong>éªŒè¯é‡ç½®ç»“æœ</strong>ï¼šé‡ç½®åè¯·ç«‹å³æµ‹è¯•æ–°å¯†ç æ˜¯å¦æœ‰æ•ˆ</li>
            </ol>
        </div>
        
        <div id="toolContent" style="display: none;">
            <div class="form-group">
                <button onclick="diagnoseProblem()">ğŸ” è¯Šæ–­å¯†ç çŠ¶æ€</button>
                <button onclick="testAccess()">ğŸ§ª æµ‹è¯•å½“å‰å¯†ç </button>
            </div>
            
            <div id="diagnosisResult" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 16px; margin: 20px 0; font-family: monospace; font-size: 14px; white-space: pre-wrap; max-height: 200px; overflow-y: auto; display: none;"></div>
            
            <div class="form-group">
                <label for="newPassword">ğŸ”‘ è®¾ç½®æ–°å¯†ç ï¼š</label>
                <input type="password" id="newPassword" placeholder="è¾“å…¥å®‰å…¨çš„æ–°å¯†ç ï¼ˆè‡³å°‘8ä½ï¼‰">
                <small style="color: #666; font-size: 12px;">å»ºè®®åŒ…å«å¤§å†™å­—æ¯ã€å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦</small>
            </div>
            
            <div class="form-group">
                <button onclick="emergencyReset()">ğŸš¨ ç´§æ€¥é‡ç½®å¯†ç </button>
                <button onclick="resetToDefault()" class="btn-danger">ğŸ”„ æ¢å¤é»˜è®¤å¯†ç </button>
            </div>
            
            <div id="result" class="result"></div>
        </div>
        
        <div class="security-note">
            <h4>ğŸ›¡ï¸ å®‰å…¨æé†’ï¼š</h4>
            <ul>
                <li>æ­¤å·¥å…·ç»•è¿‡äº†æ­£å¸¸çš„èº«ä»½éªŒè¯æµç¨‹</li>
                <li>ä½¿ç”¨å®Œæ¯•åè¯·ç«‹å³ä»æœåŠ¡å™¨åˆ é™¤æ­¤æ–‡ä»¶</li>
                <li>å»ºè®®é‡å‘½åæ–‡ä»¶åä¸ºéšæœºå­—ç¬¦ä¸²ä»¥å¢åŠ å®‰å…¨æ€§</li>
                <li>å®šæœŸæ›´æ¢ç®¡ç†å‘˜å¯†ç ï¼Œä½¿ç”¨å¯†ç ç®¡ç†å™¨ç”Ÿæˆå¼ºå¯†ç </li>
            </ul>
        </div>
    </div>

    <script>
        // åŸŸåå®‰å…¨æ£€æŸ¥
        function checkDomainSafety() {
            const domain = window.location.hostname;
            const isLocalhost = domain === 'localhost' || domain === '127.0.0.1' || domain.startsWith('192.168.') || domain.startsWith('10.') || domain.includes('local');
            const domainCheckDiv = document.getElementById('domainCheck');
            const toolContent = document.getElementById('toolContent');
            
            if (isLocalhost) {
                domainCheckDiv.className = 'domain-check safe';
                domainCheckDiv.innerHTML = `
                    <strong>âœ… æœ¬åœ°ç¯å¢ƒæ£€æµ‹</strong><br>
                    å½“å‰åŸŸå: ${domain}<br>
                    è¿™æ˜¯ä¸€ä¸ªç›¸å¯¹å®‰å…¨çš„æœ¬åœ°ç¯å¢ƒï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨æ­¤å·¥å…·ã€‚
                `;
                toolContent.style.display = 'block';
            } else {
                domainCheckDiv.className = 'domain-check unsafe';
                domainCheckDiv.innerHTML = `
                    <strong>âš ï¸ ç”Ÿäº§ç¯å¢ƒè­¦å‘Š</strong><br>
                    å½“å‰åŸŸå: ${domain}<br>
                    <strong style="color: #dc3545;">å»ºè®®ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æ­¤å·¥å…·ï¼</strong><br>
                    <button onclick="confirmProductionUse()" style="margin-top: 10px; padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">æˆ‘äº†è§£é£é™©ï¼Œç»§ç»­ä½¿ç”¨</button>
                `;
            }
        }
        
        function confirmProductionUse() {
            if (confirm('æ‚¨ç¡®å®šè¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æ­¤å·¥å…·å—ï¼Ÿ\n\nè¿™å¯èƒ½å¸¦æ¥å®‰å…¨é£é™©ï¼Œå»ºè®®ï¼š\n1. ä½¿ç”¨å®Œæ¯•åç«‹å³åˆ é™¤æ­¤æ–‡ä»¶\n2. æ£€æŸ¥æœåŠ¡å™¨è®¿é—®æ—¥å¿—\n3. æ›´æ¢ç®¡ç†å‘˜å¯†ç \n\nç‚¹å‡»ç¡®å®šç»§ç»­ï¼Œå–æ¶ˆè¿”å›')) {
                document.getElementById('toolContent').style.display = 'block';
            }
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(message, type = 'error') {
            const resultDiv = document.getElementById('result');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = message.replace(/\n/g, '<br>');
            resultDiv.style.display = 'block';
            
            // è‡ªåŠ¨æ»šåŠ¨åˆ°ç»“æœ
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }
        
        // è¯Šæ–­é—®é¢˜
        function diagnoseProblem() {
            const diagnosisDiv = document.getElementById('diagnosisResult');
            
            let diagnosis = 'ğŸ“Š å¯†ç å­˜å‚¨è¯Šæ–­ï¼š\n\n';
            
            const adminCredentials = localStorage.getItem('admin_credentials');
            const securityConfig = localStorage.getItem('security_config');
            
            if (adminCredentials) {
                try {
                    const creds = JSON.parse(adminCredentials);
                    const password = atob(creds.password);
                    diagnosis += `âœ… ç™»å½•å‡­æ®: ç”¨æˆ·å="${creds.username}", å¯†ç ="${password}"\n`;
                } catch (e) {
                    diagnosis += `âŒ ç™»å½•å‡­æ®è§£æå¤±è´¥: ${e.message}\n`;
                }
            } else {
                diagnosis += 'âŒ æœªæ‰¾åˆ°ç™»å½•å‡­æ®\n';
            }
            
            if (securityConfig) {
                try {
                    const config = JSON.parse(securityConfig);
                    if (config.password) {
                        diagnosis += `âœ… å®‰å…¨é…ç½®: å¯†ç ="${config.password.current}", ä¿®æ”¹æ—¶é—´=${new Date(config.password.lastChanged).toLocaleString()}\n`;
                    } else {
                        diagnosis += 'âš ï¸ å®‰å…¨é…ç½®å­˜åœ¨ä½†æ— å¯†ç ä¿¡æ¯\n';
                    }
                } catch (e) {
                    diagnosis += `âŒ å®‰å…¨é…ç½®è§£æå¤±è´¥: ${e.message}\n`;
                }
            } else {
                diagnosis += 'âŒ æœªæ‰¾åˆ°å®‰å…¨é…ç½®\n';
            }
            
            // è®¤è¯çŠ¶æ€
            const authKeys = ['adminLoginTime', 'adminToken', 'lastActivity'];
            diagnosis += '\nğŸ” å½“å‰è®¤è¯çŠ¶æ€:\n';
            authKeys.forEach(key => {
                const value = localStorage.getItem(key);
                diagnosis += `   ${key}: ${value ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}\n`;
            });
            
            diagnosisDiv.textContent = diagnosis;
            diagnosisDiv.style.display = 'block';
        }
        
        // æµ‹è¯•è®¿é—®
        function testAccess() {
            const password = prompt('è¯·è¾“å…¥è¦æµ‹è¯•çš„å¯†ç :');
            if (!password) return;
            
            try {
                const storedCredentials = localStorage.getItem('admin_credentials');
                if (!storedCredentials) {
                    showResult('âŒ æœªæ‰¾åˆ°å­˜å‚¨çš„å‡­æ®', 'error');
                    return;
                }
                
                const credentials = JSON.parse(storedCredentials);
                const decodedPassword = atob(credentials.password);
                
                if (password === decodedPassword) {
                    showResult(`âœ… å¯†ç éªŒè¯æˆåŠŸï¼å¯†ç  "${password}" æœ‰æ•ˆã€‚`, 'success');
                } else {
                    showResult(`âŒ å¯†ç éªŒè¯å¤±è´¥ï¼\nå­˜å‚¨çš„å¯†ç : "${decodedPassword}"\næµ‹è¯•çš„å¯†ç : "${password}"`, 'error');
                }
            } catch (error) {
                showResult(`âŒ éªŒè¯è¿‡ç¨‹å‡ºé”™: ${error.message}`, 'error');
            }
        }
        
        // ç´§æ€¥é‡ç½®
        function emergencyReset() {
            const newPassword = document.getElementById('newPassword').value;
            
            if (!newPassword) {
                showResult('âŒ è¯·å…ˆè¾“å…¥æ–°å¯†ç ï¼', 'error');
                return;
            }
            
            if (newPassword.length < 8) {
                showResult('âŒ å¯†ç é•¿åº¦è‡³å°‘8ä½ï¼', 'error');
                return;
            }
            
            if (!confirm(`ğŸš¨ ç´§æ€¥é‡ç½®ç¡®è®¤\n\næ‚¨å³å°†å°†ç®¡ç†å‘˜å¯†ç é‡ç½®ä¸º: "${newPassword}"\n\næ­¤æ“ä½œå°†ï¼š\nâ€¢ è¦†ç›–å½“å‰å¯†ç \nâ€¢ æ¸…é™¤æ‰€æœ‰ç™»å½•ä¼šè¯\nâ€¢ éœ€è¦é‡æ–°ç™»å½•\n\nç¡®å®šç»§ç»­å—ï¼Ÿ`)) {
                return;
            }
            
            try {
                // æ›´æ–°ç™»å½•å‡­æ®
                const credentials = {
                    username: 'admin',
                    password: btoa(newPassword)
                };
                localStorage.setItem('admin_credentials', JSON.stringify(credentials));
                
                // æ›´æ–°å®‰å…¨é…ç½®
                let securityConfig = {};
                try {
                    const existing = localStorage.getItem('security_config');
                    if (existing) {
                        securityConfig = JSON.parse(existing);
                    }
                } catch (e) {
                    console.log('åˆ›å»ºæ–°çš„å®‰å…¨é…ç½®');
                }
                
                securityConfig.password = {
                    current: newPassword,
                    lastChanged: Date.now(),
                    strength: 'good',
                    resetBy: 'emergency-tool',
                    resetTime: new Date().toISOString()
                };
                localStorage.setItem('security_config', JSON.stringify(securityConfig));
                
                // æ¸…é™¤è®¤è¯ä¼šè¯
                const authKeys = ['adminLoginTime', 'adminToken', 'lastActivity', 'admin_session'];
                authKeys.forEach(key => localStorage.removeItem(key));
                
                showResult(`ğŸ‰ ç´§æ€¥é‡ç½®æˆåŠŸï¼\n\næ–°å¯†ç : "${newPassword}"\né‡ç½®æ—¶é—´: ${new Date().toLocaleString()}\n\nâš ï¸ å®‰å…¨æé†’ï¼š\nâ€¢ è¯·ç«‹å³åˆ é™¤æ­¤å·¥å…·æ–‡ä»¶\nâ€¢ ä½¿ç”¨æ–°å¯†ç ç™»å½•ç®¡ç†åå°\nâ€¢ æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–äººè®¿é—®è¿‡æ­¤å·¥å…·`, 'success');
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                document.getElementById('newPassword').value = '';
                
                // 3ç§’åæç¤ºè·³è½¬
                setTimeout(() => {
                    if (confirm('é‡ç½®å®Œæˆï¼\n\nç‚¹å‡»ç¡®å®šè·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œå–æ¶ˆç»§ç»­ä½¿ç”¨å·¥å…·ã€‚')) {
                        window.location.href = 'login.html';
                    }
                }, 3000);
                
            } catch (error) {
                showResult(`âŒ é‡ç½®å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // é‡ç½®ä¸ºé»˜è®¤
        function resetToDefault() {
            if (!confirm('ğŸ”„ æ¢å¤é»˜è®¤å¯†ç ç¡®è®¤\n\nè¿™å°†æŠŠå¯†ç é‡ç½®ä¸º: "admin123"\n\nç¡®å®šç»§ç»­å—ï¼Ÿ')) {
                return;
            }
            
            const defaultPassword = 'admin123';
            
            try {
                const credentials = {
                    username: 'admin',
                    password: btoa(defaultPassword)
                };
                localStorage.setItem('admin_credentials', JSON.stringify(credentials));
                
                let securityConfig = {};
                try {
                    const existing = localStorage.getItem('security_config');
                    if (existing) {
                        securityConfig = JSON.parse(existing);
                    }
                } catch (e) {
                    console.log('åˆ›å»ºæ–°çš„å®‰å…¨é…ç½®');
                }
                
                securityConfig.password = {
                    current: defaultPassword,
                    lastChanged: Date.now(),
                    strength: 'weak',
                    resetBy: 'emergency-tool-default',
                    resetTime: new Date().toISOString()
                };
                localStorage.setItem('security_config', JSON.stringify(securityConfig));
                
                const authKeys = ['adminLoginTime', 'adminToken', 'lastActivity', 'admin_session'];
                authKeys.forEach(key => localStorage.removeItem(key));
                
                showResult(`ğŸ”„ å·²æ¢å¤é»˜è®¤å¯†ç ï¼\n\nç”¨æˆ·å: admin\nå¯†ç : admin123\n\nâš ï¸ è­¦å‘Šï¼šé»˜è®¤å¯†ç å®‰å…¨æ€§è¾ƒä½ï¼Œè¯·å°½å¿«ä¿®æ”¹ï¼`, 'success');
                
            } catch (error) {
                showResult(`âŒ æ¢å¤å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥åŸŸå
        window.addEventListener('load', checkDomainSafety);
        
        // é˜²æ­¢æ„å¤–å…³é—­
        window.addEventListener('beforeunload', function(e) {
            e.preventDefault();
            e.returnValue = 'ç¡®å®šè¦ç¦»å¼€æ­¤é¡µé¢å—ï¼Ÿæœªä¿å­˜çš„æ“ä½œå°†ä¸¢å¤±ã€‚';
        });
    </script>
</body>
</html> 